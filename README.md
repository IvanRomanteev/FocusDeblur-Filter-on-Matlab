Фильтр для снятия размытия при расфокусировке
==========================

Цель
----

В этом уроке вы узнаете:

- что такое модель изображения с ухудшением качества
- что такое PSF изображения, находящегося не в фокусе
- как восстановить размытое изображение
- что такое фильтр Винера

Теория
------

### Что такое модель ухудшения изображения?

Вот математическая модель ухудшения изображения в представлении частотной области:

[S = H*U + N]

где
S - спектр размытого (ухудшенного) изображения,
U - спектр исходного истинного (не ухудшенного) изображения,
H - частотная характеристика функции распределения точек (PSF),
N - спектр аддитивного шума.

Круговой PSF является хорошим приближением к искажению вне фокуса. Такой PSF определяется только одним параметром - радиусом R. В данной работе используется круговой PSF.

![Функция распределения точек по окружности](/www/images/psf.png)

### Как восстановить размытое изображение?

Целью восстановления (устранения размытия) является получение оценки исходного изображения. Формула восстановления в частотной области такова:

[U' = H_w*S]

где
U' - это спектр оценки исходного изображения U, а
H_w - фильтр восстановления, например, фильтр Винера.

### Что такое фильтр Винера?

Фильтр Винера - это способ восстановления размытого изображения. Давайте предположим, что PSF является реальным и симметричным сигналом, спектр мощности исходного истинного изображения и шум неизвестны,
тогда упрощенная формула Винера равна:

[H_w = rac{H}{|H|^2+rac{1}{SNR}} ]

где
SNR - это отношение сигнал/шум.

Итак, чтобы восстановить изображение, находящееся не в фокусе, с помощью фильтра Винера, ему необходимо знать SNR и R кругового PSF.

Результат
------

Ниже вы можете увидеть реальное изображение не в фокусе:
![Изображение не в фокусе](/www/images/original.jpg)


Приведенный ниже результат был дополнен параметрами R = 53 и SNR = 5200:
![Восстановленное (размытое) изображение](/www/images/recovered.jpg)

Использовался фильтр Винера, а значения R и SNR были выбраны вручную для получения наилучшего визуального результата.
Мы видим, что результат не идеален, но он дает нам представление о содержании изображения. Текст читается с некоторым трудом.

@обратите внимание, что параметр R является наиболее важным. Поэтому сначала вам следует настроить R, а затем SNR.
@примечание. Иногда на восстановленном изображении можно наблюдать эффект звона. Этот эффект можно уменьшить несколькими способами. Например, вы можете уменьшить края входного изображения.

Вы также можете найти краткую видео-демонстрацию этого на
[YouTube](https://youtu.be/0bEcE4B0XP4).

Рекомендации
------
- [Удаление размытия изображения в Matlab] - Удаление размытия изображения в Matlab
- [SmartDeblur] - сайт SmartDeblur

<!-- список невидимых ссылок -->
[Цифровая обработка изображений]: http://web.ipac.caltech.edu/staff/fmasci/home/astro_refs/Digital_Image_Processing_2ndEd.pdf
[Удаление размытия изображения в Matlab]: https://www.mathworks.com/help/images/image-deblurring.html
[SmartDeblur]: http://yuzhikov.com/articles/BlurredImagesRestor
